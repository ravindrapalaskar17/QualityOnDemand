functions:
  - camara-reserved-words
  - camara-security-no-secrets-in-path-or-query-parameters
functionsDir: "./lint_function"
rules:
  check-sensitive-data-in-paths:
    message: "Sensitive data found in path: {{error}}"
    severity: warn
    description: |
      This rule checks for sensitive data ('MSISDN' and 'IMSI') in API paths and suggests avoiding their use.
    given:
      - "$.paths"
    then:
      function: camara-security-no-secrets-in-path-or-query-parameters
  check-reserved-words-in-paths:
    message: "Reserved words found in path key: {{error}}"
    severity: warn
    description: |
      This rule checks Reserved words must not be used in the following parts of an API specification [Paths, Request Body properties, Component, Operation Id, Security Schema]
    given:
      - "$.paths"
      - "$.components.schemas.*.properties"
      - "$.components.securitySchemes"
      - "$.components"
      - "$.paths.*.*.operationId"
    then:
      function: camara-reserved-words
  camara-parameters-descriptions:
    description: This spectral rules check for the description of each parameter
    message: Parameter must have description "{{error}}"
    severity: hint
    given:
      - "$.components.*.*"
      - "$.components.*.*.properties.*"
    then:
      field: description
      function: truthy
  camara-operation-summary:
    message: Each operations should have a summary, describe short summary.
    severity: warn
    given:
      - "$.paths.*.post"
      - "$.paths.*.get"
      - "$.paths.*.delete"
      - "$.paths.*.put"
      - "$.paths.*.patch"
      - "$.paths.*.options"
    then:
      field: summary
      function: truthy    
  camara-path-param-id:
    message: Path parameter names should be "resource_id", not just "id"
    severity: warn
    given: "$..parameters[?(@.in == 'path')]"
    then:
      field: name
      function: pattern
      functionOptions:
        notMatch: \b(id|Id|ID|iD)\b    
  check-openapi-version:
    message: "OpenAPI version issue: The OpenAPI format must be 3.0.3"
    severity: error
    description: |
      This rule checks if the OpenAPI version is 3.0.3.
    given: "$"
    then:
      field: openapi
      function: pattern
      functionOptions:
        match: 3.0.3
